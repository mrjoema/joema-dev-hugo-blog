{{- $analytics := .Scratch.Get "analytics" | default dict -}}

{{- /* Only load analytics on blog posts and about page */ -}}
{{- $isPost := eq .Type "posts" -}}
{{- $isAbout := eq .RelPermalink "/tech-blog/about/" -}}

{{- if or $isPost $isAbout -}}
    {{- /* Google Analytics */ -}}
    {{- $google := $analytics.google.id | default site.Config.Services.GoogleAnalytics.ID | default site.Params.analytics.google.id -}}
    {{- with $google -}}
        {{- $respectDoNotTrack := $analytics.google.respectDoNotTrack | default site.Config.Privacy.GoogleAnalytics.RespectDoNotTrack | default site.Params.analytics.google.respectDoNotTrack -}}
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
        <script>
        {{- if $respectDoNotTrack }}
        var dnt, doNotTrack = false;
        if ({{ $respectDoNotTrack }}) {
            dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
            doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
        {{- end }}
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', '{{ . }}');
        {{- if $respectDoNotTrack }}
        }
        {{- end }}
        </script>
    {{- end -}}
{{- end -}}